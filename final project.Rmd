---
title: "Final Project"
author: "Kanya Kreprasertkul"
date: "4/4/2020"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rvest)
library(tidyverse)
library(dplyr)
library(choroplethr)
library(choroplethrMaps)
```

```{r}
tuition_cost <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_cost.csv')

tuition_income <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/tuition_income.csv') 

salary_potential <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/salary_potential.csv')
salary_potential <- unique(salary_potential)

historical_tuition <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/historical_tuition.csv')

diversity_school <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/diversity_school.csv')
```

```{r}
school_diversity <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-09-24/school_diversity.csv")
```


```{r}

t <- left_join(salary_potential, tuition_cost, by = "name")

salary_potential$state_name <- gsub("-", " ", salary_potential$state_name)
names(salary_potential)[3] <- "state"

state_code <- tuition_cost %>%
  select(state, state_code) %>%
  unique()

# library(datasets)
# data(state_codes)
#install.packages("openintro")
library(openintro)
salary_potential <- salary_potential %>% 
  mutate(state_code = state2abbr(state))
#state2abbr(state)
```

```{r}
union(t$name,salary_potential$name)

```

```{r}
tuition_cost[duplicated(tuition_cost$name),]
```

```{r}
#download world university ranking data from the website
Urank <- "https://cwur.org/2019-2020.php" %>%
  read_html() %>%
  html_table(fill = TRUE) %>%
  .[[1]]
```

```{r}
#number of universities in top ranking by country
n_country <- Urank %>%
  select(Location) %>%
  group_by(Location) %>%
  summarise(total = n()) %>%
  arrange(desc(total))

#change column name to be compatible with choroplethr package
names(n_country) <- c("region", "value")
n_country$region <- tolower(n_country$region)
#change some of region name to be compatible with choroplethr package
n_country$region[n_country$region == "usa"] <- "united states of america"
n_country$region[n_country$region == "slovak republic"] <- "slovakia"
n_country$region[n_country$region == "serbia"] <- "republic of serbia"
```

```{r}
#get region data from choroplethrMaps package
data("country.regions")
#merge all regions from choroplethrMaps package and our dataset
n_country <- full_join(n_country, country.regions %>% select(region), by = "region")
n_country$value <- replace_na(n_country$value, 0)
head(n_country)
```

We can see that USA has the highest number of universities in top ranking. 

```{r, warning = FALSE}
country_choropleth(n_country, title = "Number of universities in top ranking by country")
```
